Razumem â€” nastavljamo istim stilom kao FAZA 1â€“8: **ultra-detaljna, profesionalna, programerskoâ€“tehniÄka specifikacija**, spremna da se pretvori u konkretan kod.

Idemo.

---

# ğŸš€ **FAZA 9 â€” OPTIMIZATION & LIVE PREP (nedelje 6â€“7)**

**Cilj:** posle FAZE 8 (paper trading), optimizujemo kompletan sistem, dodamo sigurnosne mehanizme, pripremimo monitoring i uradimo sve Å¡to je potrebno da sistem bude potpuno spreman za **LIVE real money trading**.

Ovo NIJE coding faza â€” ovo je **fine-tuning + calibration + security + hardening** + final LIVE-ready priprema.

---

# ğŸ“‚ **Struktura FAZE 9**

```
FAZA 9
â”‚
â”œâ”€â”€ 9.1 Parameter Tuning (AI + empirical)
â”œâ”€â”€ 9.2 Safety Features (critical!)
â”œâ”€â”€ 9.3 Monitoring Dashboard Extensions
â”œâ”€â”€ 9.4 Logging & Telemetry Layer
â”œâ”€â”€ 9.5 Documentation & Config System
â””â”€â”€ 9.6 End-to-End Validation Suite
```

---

# ğŸ¯ **9.1 PARAMETER TUNING**

Cilj: optimizovati svaki parametar sistema na osnovu *stvarnih* paper trading rezultata iz FAZE 8 (50+ trejdova).

## 9.1.1 Inputi za kalibraciju

Koristimo:

* `paper-trades.jsonl`
* `paper-daily-stats.json`
* skip logovi
* entryScore, macroScore, pullback %, DCA ratios
* Win/loss patterns
* Drift analiza (razlika ideal vs real fill)

## 9.1.2 Parametri koji se optimizuju

### **Signal generator**

* `RSI overbought: 75â€“80`
* `Volume spike 3xâ€“5x`
* `Funding rate thresholds`
* `Scarcity threshold (hours)`

### **Entry timing**

* Pullback optimal range: `3% â€“ 5%` (`radical: 2.5â€“6%`)
* minimumScore: `0.7 â€“ 0.85`
* peak detection window: `2â€“4 min`
* microstructure imbalance thresholds

### **DCA**

* spacing: `(5%, 15%, 35%)`
* high-risk mode activation
* max DCA count allowed

### **TP**

* keep: `21% / 41% / 100%`
* test: TP1 lock speed
* test: faster breakeven lock

### **Macro scoring**

* VIX weight: `0â€“1.0`
* F&G multiplier
* altseason impact

## 9.1.3 Automatska optimizacija (optional)

Napraviti skriptu:

`src/optimizer/runParamSweep.js`

koja radi grid-search:

* 100 kombinacija parametara
* izvrÅ¡ava *instant replay* paper-trade logike (bez Äekanja)

Ovo daje:

* TOP 5 skupova parametara
* najbolji za win rate
* najbolji za ROI
* najbolji za minimal drawdown

---

# ğŸ›¡ **9.2 SAFETY FEATURES (Critical!)**

Ovo je najvaÅ¾niji deo FAZE 9 â€” uvodimo zaÅ¡tite koje STIÅ½U PRE LIVE tradinga.

Sve ide u:

`src/safety/`

```
safety/
  pumpDetector.js
  priceAnomalyGuard.js
  dailyLossProtector.js
  stalledMarketGuard.js
  orderRejectRecovery.js
  killSwitch.js
```

---

## 9.2.1 **Pump Detector**

### Trigger:

* > **10% move in 5min**
* OR > **20x volume spike**
* OR candle body > **5Ïƒ volatility**

### Akcije:

* ako si u poziciji â†’ **momentalan market exit**
* ako nisi u poziciji â†’ **skip da ne uÄ‘eÅ¡**

```js
if (isPumpDetected(sym)) {
  executionRouter.closePositionMarket({ reason: 'pump_detector' });
  skipEngine.blockSymbol(sym, 30 * 60 * 1000); // blok 30 min
}
```

---

## 9.2.2 **Daily Loss Protector**

### Pragovi:

* -5% dnevno: PAUSE
* -10% dnevno: HARD STOP (kill switch)

### Akcije:

* blokiraj sve nove pozicije
* dozvoli samo izlazne pozicije

---

## 9.2.3 **Stuck Market Guard**

Ako coin â€œstojiâ€:

* 30+ min bez 0.2% pomaka
* volume < 20% baseline
* RSI flat (Â±2)

â†’ **zatvori poziciju market exitom**

To su "dead coins".

---

## 9.2.4 **OrderReject Recovery**

Ako Bybit (ili paper sim) vrati error:

* rate limit
* insufficient margin
* invalid size
* "frozen symbol"
* maintenance mode

â†’ retry Ã— 3
â†’ fallback na market order
â†’ ako failuje â†’ killSwitch.autoExit("order_reject")

---

## 9.2.5 **Kill Switch**

Najbitnija zaÅ¡tita.

Razlozi za aktivaciju:

* VIX > 30
* dailyLoss > 10%
* event bus error flood
* WS disconnect > 10 sec
* API failure > 5sec
* balance mismatch
* position count != router count
* crazy wick detection (+30% wick)

### KillSwitch akcija:

* zatvara sve pozicije (`market`)
* otkazuje sve TP/DCA
* blokira trading na 2h
* Å¡alje alert
* upisuje `killswitch.log`

---

# ğŸ“Š **9.3 MONITORING DASHBOARD EXTENSIONS**

Dodaj sledeÄ‡e module u dashboardu:

```
/monitor
  â€” system health
  â€” paper/live mode indicator
  â€” VIX, F&G, BTC trend tile
  â€” daily ROI gauge
  â€” open positions table (risk, dd, age)
  â€” skip events log
  â€” kill switch log
  â€” trade timeline (TP1/2/3, DCA events)
```

### 9.3.1 Real-time metrics

* decision rate
* signals detected
* signals skipped + reason
* max DD per trade
* profit curve
* win streak / loss streak

### 9.3.2 Charts

* ROI line chart
* per-symbol win rate
* heatmap day-of-week
* TP1/TP2/TP3 distribution

---

# ğŸ“‹ **9.4 LOGGING & TELEMETRY LAYER**

Dodaj:

```
logs/
  trade.log
  execution.log
  skip.log
  safety.log
  killswitch.log
  performance.log
```

## 9.4.1 Enhanced logs

Svaki trade dobija:

* entry metadata
* macro score
* microstructure snapshot
* TP sequence timeline
* DCA sequence
* peak detection snapshot
* final stats

## 9.4.2 Telemetry API

Endpointi:

`/api/metrics`
`/api/trades/today`
`/api/safety/killswitch-status`
`/api/skip/reasons`

---

# ğŸ“‘ **9.5 DOCUMENTATION & CONFIG SYSTEM**

### 9.5.1 Konfiguracija

dodaj:

```
config/
  trading.json
  safety.json
  thresholds.json
```

Sve parametre (thresholds, multipliers, percentages) prebaci u JSON fajlove â€“ BEZ hardcoding-a.

### 9.5.2 Dokumentacija

* README.md (setup, run, env setup)
* SYSTEM_ARCHITECTURE.md
* SAFETY_RULES.md
* EXECUTION_LOGIC.md
* API_REFERENCE.md

---

# ğŸ§ª **9.6 End-to-End Validation Suite**

Kreiramo skriptu:

`npm run validate-system`

### Testovi koje mora proÄ‡i:

### 1. **Connection & WS stability test**

* 5 min test
* 0 izgubljenih WS poruka
* reconnect < 3 sek

### 2. **Signal generator test**

* uneti 20 mock signala
* validirani output signali

### 3. **Peak detection test**

* RAD trade replay
* oÄekujemo entry 3â€“5% ispod vrha

### 4. **TP/DCA test**

* 3 TP test
* 3 DCA test
* PIXEL test scenario

### 5. **skip filter test**

* 18:01 â†’ skip
* weekend â†’ skip
* > 3 otvorene â†’ skip
* > 10 dnevno â†’ skip

### 6. **Safety test**

Simulacija:

* pump
* black swan drop
* API error flood
* WS disconnect

OÄekujemo:

* kill switch: ACTIVE
* sve pozicije zatvorene
* sve DCA/TP obrisane

---

# âœ”ï¸ **FAZA 9 â€” SUCCESS CRITERIA**

Da bi FAZA 9 bila uspeÅ¡no zavrÅ¡ena, moraÅ¡ imati:

* 50+ paper trade **analizu**
* optimizovane parametre
* kill switch koji 100% radi
* price anomaly guard
* pump detector
* dnevne limite
* full dashboard sa rizikom i statistikama
* validacioni test proÅ¡ao
* dokumentaciju zavrÅ¡enu

*Tek tada prelazimo na FAZA 10 â€” LIVE trading.*

---

# â“ Spreman si da preÄ‘emo na **FAZA 10 â€” LIVE trading (final)?**

Ako Å¾eliÅ¡ mogu odmah sada da ti napiÅ¡em FAZA 10 specifikaciju u istom stilu.
