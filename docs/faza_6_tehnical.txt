OdliÄno â€” sada kreÄ‡e **OPCIJA A â€” ULTRA DETALJAN, PRODUKCIJSKI PROGRAMERSKO-TEHNIÄŒKI PLAN ZA FAZU 6**.
Pisano kao da se pravi interni dokument hedge-fonda.
Sve odluke su optimalne, bez pitanja, 100% prilagoÄ‘ene tvom AI Scalper sistemu koji smo gradili poslednjih 5 faza.

---

# ğŸš€ **FAZA 6 â€“ SCORING & SIGNAL ENGINE**

## **ULTRA DETALJAN PROGRAMERSKO-TEHNIÄŒKI PLAN (verzija za implementaciju)**

---

# ğŸ§© 0. KONTEKST â€“ NA ÄŒEMU SE FAZA 6 ZASNIVA

Faza 6 **direktno zavisi** od svega implementiranog do sada:

### ğŸ”µ Faza 1 â€“ Core scaffolding

* CONFIG sistem
* health monitoring
* API i ruta struktura
* path sistem
* PM2 procesi

### ğŸ”µ Faza 2 â€“ Konektori + Universe

* bybitPublic WS feed
* REST wrapper
* SymbolProfile
* Universe kategorizacija (Prime / Normal / Wild)

### ğŸ”µ Faza 3 â€“ Microstructure engine

* orderbook snapshot
* trades ring-buffer
* micro-candles (1s / 3s / 5s / 15s)
* JSON snapshot pipelines

### ğŸ”µ Faza 4 â€“ Feature engine

Kreiraju se kljuÄni sirovi features:

* orderbook imbalance
* walls & spoofing
* trade flow / delta
* volatility engine
* fee/leverage engine
* pump pre-signals
* kompletan FeatureState snapshot

### ğŸ”µ Faza 5 â€“ Regime engine

Odluke o trÅ¾iÅ¡nom stanju:

* per-symbol reÅ¾imi
* global reÅ¾imi
* cooldown
* pump state
* manipulation state
* news-driven state
* PANIC / RISK-OFF sistem globalnog zakljuÄavanja

---

**TEK SADA** scoring engine moÅ¾e da postoji, jer bazira svoje odluke na:

* mikro-strukturi
* feature-ima
* reÅ¾imima
* fee riziku
* pump riziku
* volatilnosti
* spoof riziku
* globalnom reÅ¾imu

---

# ğŸ¯ **1. CILJ FAZE 6**

Faza 6 uvodi *inteligentni matematiÄko-logiÄki filter* koji:

1. **iz svih features i reÅ¾ima izraÄunava BaseScalpScoreLong & Short (0â€“100)**
2. **primenjuje sve rizike, penale, reÅ¾ime, globalna pravila**
3. **izraÄunava FinalScalpScoreLong & Short (0â€“100)**
4. **pretvara final score u jednostavne signale:**

* NONE
* WATCH_LONG / WATCH_SHORT
* ARM_LONG / ARM_SHORT

ğŸŸ¥ Faza 6 NE otvara pozicije.
ğŸŸ© Ona samo odreÄ‘uje â€ko je potencijalno zanimljivâ€œ â€“ Å¡to kasnije koristi State Machine.

---

# ğŸ—ï¸ **2. ARHITEKTURA FAZE 6**

### Novi moduli koje moraÅ¡ kreirati:

```
src/scoring/scoringModel.js     â† Äista logika izraÄunavanja (matematiÄko jezgro)
src/scoring/scoringEngine.js    â† orchestrator (event loop i snapshot-i)
```

### Ostatak sistema koji se menja:

```
src/features/featureEngine.js  â† dodaje scoring hook
src/regime/regimeEngine.js     â† scoring Äita reÅ¾ime
src/monitoring/health.js       â† dodaje scoring health sekciju
web/routes/api.js              â† dodaje score i scanner rute
data/metrics/<symbol>.json     â† snapshot proÅ¡iren scoring informacijama
```

### DrÅ¾anje state-a u memoriji:

```
ScoringEngineState = {
   perSymbol: {
      BTCUSDT: ScoreState,
      ETHUSDT: ScoreState,
      ...
   },
   lastUpdateAt: ISO,
   updateIntervalMs: 1000
}
```

---

# ğŸ§  **3. SCORING MODEL (logiÄko jezgro)**

### Putanja:

```
src/scoring/scoringModel.js
```

Ovaj modul *NE zna niÅ¡ta* o reÅ¾imu, risku, globalnom stanju.
Ovaj modul samo uzima **FeatureState** i matematiÄki generiÅ¡e:

* baseLong
* baseShort
* sve komponente koje grade score

To je â€Äista naukaâ€œ.

---

# ğŸ§© 3.1. Ulazi scoring modela

```
computeBaseScores(symbol, FeatureState) â†’ { baseLong, baseShort }
```

FeatureState sadrÅ¾i:

* imbalance
* walls
* spoof
* flow
* volatility
* feeLeverage
* pumpSignals
* (future: sentiment, news, global info)

Sve ovo je naÅ¡ input.

---

# ğŸ§© 3.2. Kako se raÄunaju komponente (najvaÅ¾ni deo)

### ğŸŒ 1) Orderbook score

LONG:

* pozitivan tobImbalance
* pozitivan zoneImbalanceShort/Mid/Far
* jaki bid zidovi
  â†’ poveÄ‡ava scoreLong

SHORT:

* negativan tobImbalance
* jaki ask zidovi
  â†’ poveÄ‡ava scoreShort

Normalize â†’ 0â€“100

---

### ğŸ”¥ 2) Flow/Delta score

LONG:

* buyVolume1s/5s/15s pozitivan
* deltaRatio1s/5s/15s pozitivan
* dominanceStreakSeconds pozitivan
  â†’ viÅ¡e nego 50% delta = bullish

SHORT:

* isto, ali za sell

Normalize â†’ 0â€“100

---

### ğŸ§± 3) Walls score

LONG:

* absorbingSupportScore visok

SHORT:

* absorbingResistanceScore visok

Normalize â†’ 0â€“100

---

### ğŸ­ 4) Spoof penalty

Ovo je penal (0â€“100).
High spoofingScore â†’ loÅ¡e â†’ oduzimamo od finalnog.

---

### ğŸŒªï¸ 5) Volatility score

Preuzimamo raw volatilityScore iz F4 i skaliramo u 0â€“100.

Idealno (za scalping):

* previÅ¡e slaba vol â†’ penal
* previÅ¡e jaka vol â†’ penal

â†’ scoringModel primenjuje funkciju oblika **invertovane parabole** (optimalna srednja vola).

---

### ğŸ’° 6) FeeEdge score

Ovo je jedna od NAJVAÅ½NIJIH komponenti.

Formula (optimalna):

```
atr5s / minMoveForProfit â†’ edge score
```

Ako ATR5s mnogo veÄ‡i od minimalnog potrebnog pomaka za profit â†’ score je velik.

Normalize â†’ 0â€“100.

---

### ğŸ”¥ 7) Pump penalty

pumpLikelihoodScore â†’ penal za LONG

Za SHORT:

* penal je 40â€“60% slabiji, ali NE daje bonus zbog rizika.

---

### ğŸ“¢ 8) News penalty

newsImpactScore (iz RegimeState) â†’ penal za oba smera.
Ako > 80 â†’ trade nije dozvoljen, finalScore = 0.

---

# ğŸ§© 3.3. Sastavljanje baseScore

Sve komponente se kombinuju:

```
rawLong =
   + orderbookScoreLong   * w_orderbookLong
   + flowScoreLong        * w_flowLong
   + wallsScoreLong       * w_wallsLong
   + volatilityScore      * w_vola
   + feeEdgeScore         * w_fee
   - spoofPenalty         * w_spoof
   - pumpPenalty          * w_pump
   - newsPenalty          * w_news
```

OgraniÄiti:

```
baseScoreLong = clamp(rawLong, 0, 100)
```

Isto za SHORT.

---

# ğŸ§° **4. REÅ½IMI & RIZIK â€“ applyRegimeAndRiskFilters()**

Putanja:

```
src/scoring/scoringModel.js
```

Ulazi:

* baseLong, baseShort
* RegimeState
* GlobalRegime
* RiskState (stub)
* CONFIG.scoring

---

## ğŸŸ¥ 4.1. GlobalRegime filter

PANIC:

```
allowed = false
finalScore = 0
blockedReasons += ["GLOBAL_PANIC"]
```

RISK-OFF:

```
allowed = false
finalScore = 0
blockedReasons += ["GLOBAL_RISK_OFF"]
```

NORMAL:

```
allowed = true
```

---

## ğŸŸ§ 4.2. Per-symbol Regime filter

Ako je:

### PUMP:

LONG zabranjen
SHORT *moÅ¾e* biti dozvoljen ali penalizovan

### MANIPULATED:

Obe strane zabranjene.

### NEWS_DRIVEN:

Obe strane zabranjene.

### COOLDOWN:

Obe strane zabranjene (ili 80% penal).

### NORMAL:

Sve opcije dozvoljene.

---

## ğŸŸ¨ 4.3. Risk filter (stub sada, pun u Fazi 09)

Za Fazu 6 default:

```
riskAllowNewPositions = true
riskAllowNewLong = true
riskAllowNewShort = true
```

Ali scoringEngine mora imati hook za ovo jer Ä‡e kasnije risk engine blokirati signale.

---

## ğŸŸ© 4.4. Odluka o allowed / finalScore

Ako **allowed = false**:
â†’ finalScore = 0
â†’ signalState = "NONE"

Ako **allowed = true**:
â†’ finalScore = scaleAdjustments(baseScore)

Scale adjustments =

* volatilnost previÅ¡e velika â†’ reduce 0.8Ã—
* minMoveForProfit previsok â†’ reduce 0.6Ã—
* spoofSignal visok â†’ reduce 0.5Ã—
* pumpRisk umereno visok â†’ reduce 0.7Ã—

---

# ğŸ“Š **5. SIGNAL STATE â€“ core logika**

Nakon finalScore:

```
if finalScore < watchThreshold:
    signal = "NONE"
else if finalScore < armThreshold:
    signal = "WATCH"
else:
    signal = "ARM"
```

Za svaki smer posebno:

* WATCH_LONG
* WATCH_SHORT
* ARM_LONG
* ARM_SHORT

---

# âš™ï¸ **6. SCORING ENGINE â€“ orchestrator**

Putanja:

```
src/scoring/scoringEngine.js
```

Ovaj modul radi:

* periodiÄan loop
* update skorova
* snapshot u JSON
* hotlist generator
* API lookup

---

## ğŸ§© 6.1. Inicijalizacija

```
initScoringEngine() {
    state = ScoringEngineState
    setInterval(updateAllScores, CONFIG.scoring.updateIntervalMs)
}
```

### Najbolji interval:

* Prime simboli: 1s
* Normal simboli: 2s
* Wild simboli: 3â€“5s

Ali zbog prostote â†’ **1s za sve** i kasnije optimizacija.

---

## ğŸ§© 6.2. updateScoreForSymbol(symbol)

```
featureState = FeatureEngine.getState(symbol)
regimeState  = RegimeEngine.getSymbolRegime(symbol)
globalRegime = RegimeEngine.getGlobalRegime()
riskState    = RiskEngine.getMinimalStub()
```

Zatim:

```
{ baseLong, baseShort } =
     scoringModel.computeBaseScores(symbol, featureState)

{ finalLong, finalShort } =
     scoringModel.applyRegimeAndRiskFilters(...)

Save ScoreState â†’ ScoringEngineState.perSymbol[symbol]
```

Snapshot u:

```
data/metrics/<symbol>.json
```

---

## ğŸ§© 6.3. updateAllScores()

Loop kroz Universe Prime + Normal simbole.

---

# ğŸŒŸ **7. HOTLIST ENGINE (pre-scanner)**

Putanja:

```
scoringEngine.getScannerHotlist()
```

Logika:

```
filter by:
 - finalScore >= watchThreshold
 - allowed == true
 - regime == NORMAL
 - global == NORMAL

sort DESC by finalScore

limit to CONFIG.scoring.maxWatchCandidates
```

Output format:

```
[
   {
     symbol: "BTCUSDT",
     side: "LONG",
     finalScore: 81,
     signal: "ARM",
     pumpRisk: 0.02,
     spoofingLevel: 0.1
   },
   ...
]
```

---

# ğŸŒ **8. API ENDPOINTS**

Dodaje se:

### 1) Skor po simbolu

```
GET /api/symbol/:symbol/score
```

### 2) Hotlist

```
GET /api/scanner/hotlist
```

Query parametri:

* side=BOTH/LONG/SHORT
* minScore
* limit

---

# â¤ï¸ **9. HEALTH MONITORING**

Dodaje se u health:

```
services.scoringEngine = {
   status: "OK",
   lastUpdateAt: timestamp,
   symbolsUpdated: number,
   updateIntervalMs: 1000
}
```

---

# ğŸ§ª **10. TEST SCENARIJI (OBAVEZNI)**

### Test 1 â€” Bullish scenario

* pozitivan orderbook imbalance
* pozitivan flow
  â†’ baseLong â†’ visok score

### Test 2 â€” Pump reÅ¾im blokira long

RegimeState = PUMP
â†’ finalLong = 0
â†’ blockedReasons=["PUMP"]

### Test 3 â€” Spoof blokira skor

spoofingScore=0.8 â†’ finalScoreLong=0

### Test 4 â€” Global risk-off

globalRegime = RISK_OFF â†’ sve finalScore = 0

### Test 5 â€” WATCH/ARM logika

finalScoreLong = 55 â†’ WATCH
finalScoreLong = 85 â†’ ARM

### Test 6 â€” Hotlist sort

Hotlist mora biti sortiran DESC po finalScore.

---

# ğŸ§¨ **11. FINALNI REZULTAT FAZE 6**

Posle implementacije Faze 6:

### âœ” Svaki simbol ima kompletan score za LONG i SHORT

### âœ” Bot zna Å¡ta je zanimljivo (WATCH)

### âœ” Bot zna Å¡ta je spremno (ARM)

### âœ” Bot ignoriÅ¡e loÅ¡e simbole

### âœ” Bot ne trejduje tokom PUMP, MANIPULATION, NEWS, COOLDOWN

### âœ” Bot se zatvara tokom GLOBAL PANIC

### âœ” Dashboard ima HOTLIST u realnom vremenu

### âœ” System spreman za Fazu 7 (STATE MACHINE)

---

# ğŸ”¥ SLEDEÄ†I KORAK

Ako Å¾eliÅ¡ mogu odmah:

### ğŸ”µ **Napraviti FAZU 7 â€“ STATE MACHINE ultra detaljan plan**

ili

### ğŸ”µ **PreÄ‡i na implementaciju Faze 6 (kod)**

ili

### ğŸ”µ **Napraviti kompletan â€œvisual flowchartâ€ za F6 + F7**

Samo reci Å¡ta Å¾eliÅ¡ kao sledeÄ‡e.
