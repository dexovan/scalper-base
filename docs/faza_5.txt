========================================
PHASE 05 ‚Äì REGIME ENGINE (PER-SYMBOL + GLOBAL MARKET REGIMES)
FINAL SPEC (TXT EDITION ‚Äì VEOMA DETALJNO)

PREGLED

Phase 05 je jedan od NAJBITNIJIH slojeva celog AI Scalper sistema.

Dok Phase 04 daje SIROVE FEATURE-E (imbalance, walls, spoofing, flow, volatility, pump-pre-signals),
Faza 05 uvodi:

RegimeState per simbol

Global Market Regime

blokade (BLOCKED_REGIME)

cooldown logiku

pravila prelaza izmeƒëu re≈æima

risk interfejs izmeƒëu feature-engine i scoring/state-engine

RegimeState odluƒçuje:

kada je simbol NORMAL (trading dozvoljen)

kada je u PUMP modu (zabraniti long, mo≈æda dozvoliti samo controlled shorts)

kada je MANIPULATED (spoofing visok ‚Üí zabraniti scalping)

kada je NEWS_DRIVEN (novosti ‚Üí smanjiti leverage, mo≈æda blokirati trading)

kada je u COOLDOWN (nakon velike eksplozije volatilnosti)

GlobalRegime odluƒçuje:

kada celo tr≈æi≈°te ulazi u RISK_OFF

kada je PANIC (zatvoriti pozicije, freeze)

kada je normalno

Sve ovo je apsolutno kljuƒçno da bot NE ulazi u gubitniƒçke trejdove tokom pumpova, spoof manipulacija, ili tr≈æi≈°nih kolapsa.

Phase 05 NE radi scoring, NE radi entry odluku ‚Äî samo daje ‚Äûokru≈æenje‚Äú koje scoring mora da po≈°tuje.

FAJLOVI KOJE OVA FAZA KREIRA ILI MENJA

Novi fajlovi:

src/regime/regimeEngine.js
src/regime/symbolRegime.js
src/regime/globalRegime.js

Izmene:

src/features/featureEngine.js
src/monitoring/health.js
web/routes/api.js (novi endpoint /api/symbol/:symbol/regime i /api/regime/global)
data/metrics/<symbol>.json (sada dobija i regime informacije)

STRUKTURA U MEMORIJI ‚Äì REGIME STATE

2.1 Per-symbol RegimeState objekat

RegimeState (po simbolu):

symbol: string

current: string

moguƒáe vrednosti:

"NORMAL"

"PUMP"

"MANIPULATED"

"NEWS_DRIVEN"

"COOLDOWN"

updatedAt: string (ISO datetime poslednje promene)

Detaljnije informacije per re≈æim:

pumpState: string ("NONE", "PREPUMP", "PUMPING", "BLOWOFF", "DUMP", "COOLDOWN")

pumpStrength: number (0.0 ‚Äì 1.0)

spoofingLevel: number (0.0 ‚Äì 1.0)

newsImpactScore: number (0 ‚Äì 100)

volatilityScore: number (0.0 ‚Äì 1.0)

Cooldown state:

cooldownActive: boolean

cooldownEndsAt: string (ISO)

cooldownReason: string ("VOLATILITY_EXPLOSION", "PUMP", "MANIPULATION", "NEWS")

2.2 GlobalRegime objekat

GlobalMarketRegime:

current: string

"GLOBAL_NORMAL"

"GLOBAL_RISK_OFF"

"GLOBAL_PANIC"

btcVolatilityScore: number

ethVolatilityScore: number

crossMarketCrashScore: number

lastUpdateAt: string (ISO)

Global freeze:

allowNewPositions: boolean

forceClosePositions: boolean

(ovo scoring i execution kasnije koriste)

2.3 Glavna struktura za sve simbole

RegimeEngineState:

perSymbol: mapa

kljuƒç: string (symbol)

vrednost: RegimeState

globalRegime: GlobalMarketRegime

ULAZNI PODACI ZA REGIME ENGINE

RegimeEngine koristi feature-e iz Phase 04:

Iz FeatureState:

imbalance.tobImbalance

walls.absorbingSupportScore

spoofing.spoofingScore

flow.dominanceStreakSeconds

volatility.volatilityScore

volatility.explosionFlag

pumpSignals.priceChange5sPct

pumpSignals.volumeSpike5s

pumpSignals.pumpLikelihoodScore

Iz News Engine (stub za sada):

newsImpactScore (0‚Äì100)

newsType (string)

Iz Universe (Phase 2):

symbolMeta.status

isNewListing

Iz Global market feed:

BTCUSDT volatility FROM volatilityEngine

ETHUSDT volatility FROM volatilityEngine

MODUL: src/regime/symbolRegime.js

4.1 Svrha

Za svaki simbol izraƒçunava:

trenutno stanje simbola (NORMAL/PUMP/MANIPULATED/NEWS_DRIVEN/COOLDOWN)

reason za prelaz

cooldown logiku

4.2 Funkcija koju modul eksportuje

determineSymbolRegime(symbol, featureState, newsState, previousRegimeState)

Parametri:

symbol: string

featureState: FeatureState (iz Phase 04)

newsState: objekat sa poljima:

impactScore: number

type: string

previousRegimeState: RegimeState

Povratna vrednost:

novi RegimeState objekat

4.3 Algoritamska logika

Regime odreƒëuje sledeƒái redosled prioriteta (najgore stanje ima prednost):

P1 ‚Äì NEWS DRIVEN
Ako newsImpactScore >= CONFIG.regime.newsHighImpactThreshold
‚Üí current = "NEWS_DRIVEN"

P2 ‚Äì MANIPULATED
Ako spoofingScore >= CONFIG.regime.spoofingHighThreshold
‚Üí current = "MANIPULATED"

P3 ‚Äì PUMP
Ako pumpSignals.pumpLikelihoodScore >= CONFIG.regime.pumpThreshold
‚Üí current = "PUMP"

P4 ‚Äì COOLDOWN
Ako volatility.explosionFlag == true
‚Üí current = "COOLDOWN" i cooldown traje npr. 15‚Äì30 sekundi

P5 ‚Äì NORMAL
Sve ostalo ‚Üí current = "NORMAL"

4.4 Cooldown logika

Ako previousState.current != "COOLDOWN"
i novi current == "COOLDOWN":

cooldownActive = true

cooldownEndsAt = now + CONFIG.regime.cooldownDurationMs

Ako smo u COOLDOWN:

ako now < cooldownEndsAt ‚Üí ostajemo u COOLDOWN

ako now >= cooldownEndsAt ‚Üí izlazimo iz COOLDOWN i prelazimo u NORMAL

4.5 Pump dodatne nijanse

Ako pumpSignals.priceChange5sPct jako veliki (npr > 5‚Äì10%) ‚Üí preferirani re≈æim: "PUMP"

Ako pumpState ranije bio "BLOWOFF":

mo≈æe automatski pokrenuti COOLDOWN na kraƒái period (npr. 8‚Äì12 sekundi)

4.6 Manipulation re≈æim

Ako spoofingScore dugo visok (npr > 0.7 i traje 20+ sekundi):

sistem se ‚Äûzamrzava‚Äú za taj simbol

state = "MANIPULATED"

4.7 News driven

Ako newsState.impactScore >= 80:

completely block trading

COOLDOWN ends only when impactScore padne ispod praga

4.8 Rezultat

RegimeState objekat:

current

updatedAt

pumpStrength

spoofingLevel

newsImpactScore

volatilityScore

cooldownActive

cooldownEndsAt

cooldownReason

MODUL: src/regime/globalRegime.js

5.1 Svrha

Gleda BTC, ETH i op≈°te tr≈æi≈°ne signale i odreƒëuje globalno tr≈æi≈°no stanje.

5.2 Ulazni podaci

Potrebni feature listes:

BTCUSDT volatilityScore

ETHUSDT volatilityScore

BTCUSDT dump/pump pre-signals

broad sell pressure (suma delta signala za veƒáinu simbola)

cross-market correlation

veƒá postojeƒáe per-symbol regimes (broj simbola u PUMP/MANIPULATED)

5.3 Funkcija koju modul eksportuje

determineGlobalRegime(allFeatureStates, allSymbolRegimes)

Parametri:

allFeatureStates: mapa symbol ‚Üí FeatureState

allSymbolRegimes: mapa symbol ‚Üí RegimeState

Povratna vrednost:

GlobalMarketRegime objekat

5.4 Algoritam

GLOBAL_PANIC (najgori sluƒçaj):
Ako:

BTC volatilityScore > 0.9

global delta ekstremno negativan

veƒáina simbola u COOLDOWN ili MANIPULATED
‚Üí current = "GLOBAL_PANIC"
‚Üí forceClosePositions = true
‚Üí allowNewPositions = false

GLOBAL_RISK_OFF:
Ako:

volatilityScore(BTC) > 0.7

veliki broj simbola u PUMP/MANIPULATED

priceChange5sPct(BTC) < -3%
‚Üí current = "GLOBAL_RISK_OFF"
‚Üí allowNewPositions = false
‚Üí forceClosePositions = false

GLOBAL_NORMAL:
Sve ostalo
‚Üí allowNewPositions = true
‚Üí forceClosePositions = false

5.5 GlobalRegime objekt

current: string

btcVolatilityScore: number

ethVolatilityScore: number

crossMarketCrashScore: number

lastUpdateAt: string

allowNewPositions: boolean

forceClosePositions: boolean

MODUL: src/regime/regimeEngine.js

6.1 Svrha

Koordinira:

per-symbol regime izraƒçunavanje

global regime

snapshot-e

integraciju sa featureEngine

API dostupnost

6.2 Funkcije koje modul eksportuje

initRegimeEngine()

postavlja prazne strukture

uƒçitava config

pokreƒáe periodic update (svakih npr. 1‚Äì2 sekunde)

updateSymbolRegime(symbol)

uzima featureState za simbol

uzima newsState

uzima prethodni regimeState

poziva determineSymbolRegime()

upisuje u RegimeEngineState.perSymbol

updateAllSymbolRegimes()

loop kroz sve simbole iz Universe

poziva updateSymbolRegime

updateGlobalRegime()

koristi BTC, ETH feature-e

koristi sve per-symbol re≈æime

poziva determineGlobalRegime()

getSymbolRegime(symbol)

vraƒáa RegimeState ili null

getGlobalRegime()

vraƒáa GlobalMarketRegime

JSON FAJLOVI

7.1 data/metrics/<symbol>.json

Sada, uz FeatureState, ukljuƒçuje:

"regime": {
"current": string,
"updatedAt": string,
"pumpState": string,
"pumpStrength": number,
"spoofingLevel": number,
"newsImpactScore": number,
"volatilityScore": number,
"cooldownActive": boolean,
"cooldownEndsAt": string,
"cooldownReason": string
}

7.2 data/system/global_regime.json

Sadr≈æi:

current

lastUpdateAt

allowNewPositions

forceClosePositions

btcVolatilityScore

ethVolatilityScore

crossMarketCrashScore

API ENDPOINTS

8.1 GET /api/symbol/:symbol/regime

Response JSON:

symbol

current

updatedAt

pumpState

pumpStrength

spoofingLevel

newsImpactScore

volatilityScore

cooldownActive

cooldownEndsAt

8.2 GET /api/regime/global

Response JSON:

current

allowNewPositions

forceClosePositions

btcVolatilityScore

ethVolatilityScore

crossMarketCrashScore

8.3 GET /api/regime/overview

Vraƒáa listu simbola + njihov re≈æim:

symbol

regime.current

spoofingLevel

volatilityScore

pumpStrength

DASHBOARD PRIKAZ POSLE PHASE 05

Dashboard mo≈æe da prika≈æe:

Global status bar

NORMAL / RISK_OFF / PANIC

boje:

GREEN (normal)

ORANGE (risk-off)

RED (panic)

Hot list tablica

per symbol:

regime

pumpStrength

spoofingLevel

cooldownActive

volatilityScore

Symbol detail

kompletan RegimeState

countdown do cooldown zavr≈°etka

Upozorenja (alert icons):

üö® NEWS_DRIVEN

üî• PUMP

üé≠ MANIPULATED

‚ùÑÔ∏è COOLDOWN

TEST SCENARIJI

Test 1 ‚Äì Pump re≈æim:

Simulirati pumpLikelihoodScore = 0.9 ‚Üí current = "PUMP"

Test 2 ‚Äì Spoof re≈æim:

spoofingScore = 0.8 ‚Üí current = "MANIPULATED"

Test 3 ‚Äì News re≈æim:

newsImpactScore = 92 ‚Üí current = "NEWS_DRIVEN"

Test 4 ‚Äì Cooldown:

explosionFlag = true ‚Üí current = "COOLDOWN" + cooldownEndsAt set

Test 5 ‚Äì Global panic:

BTC vola > 0.9 ‚Üí current = "GLOBAL_PANIC"

Test 6 ‚Äì Global risk-off:

BTC vola > 0.7 ‚Üí current = "GLOBAL_RISK_OFF"

Test 7 ‚Äì Normal:

sve nisko ‚Üí GLOBAL_NORMAL + per-symbol NORMAL

FINALNI REZULTAT FAZE 05

Nakon Phase 05 tvoj sistem:

zna kada je simbol NORMAL, PUMP, MANIPULATED, NEWS_DRIVEN, COOLDOWN

zna kada je celo tr≈æi≈°te GLOBAL_NORMAL, RISK_OFF ili PANIC

mo≈æe da blokira otvaranje trejdova kada je riziƒçno

mo≈æe da zatvori trejdove tokom global panic-a

daje scoring engine-u ‚Äûokru≈æenje‚Äú za dono≈°enje odluka

daje state-machine-u jasne granice ≈°ta je DOZVOLJENO a ≈°ta ZABRANJENO

dashboard prvi put prikazuje stvarno inteligentno tr≈æi≈°no stanje

Phase 05 je OGROMAN korak ‚Äî posle ovoga bot vi≈°e nema ‚Äûslepe trejdove‚Äú.

========================================
KRAJ DOKUMENTA ‚Äì PHASE 05
