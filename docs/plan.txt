0. CILJ SISTEMA ‚Äì v2.0 (vrhunski)
Sistem treba da:
1.	Skenira ceo Bybit linear USDT perp u realnom vremenu.
2.	Razume po simbolu:
o	orderbook (imbalance, zidovi, spoofing),
o	trade flow (agresor, odbrana),
o	volatilnost i pump/pump&dump faze,
o	news/sentiment (min. stub + kasnije pravi feed),
o	realan fee-first profit uz leverage i slippage.
3.	Donosi odluku:
o	normalan (scalp OK),
o	pump mod (specijalan re≈æim),
o	manipulisan / spoofing (smanjiti risk / blokirati),
o	news-driven (specijalan re≈æim).
4.	Upravlj–∞ pozicijama:
o	entries, SL/TP, break-even,
o	unrealized PnL, R, portfolio heat.
5.	Sve ƒçuva u JSON + retention >24h, sa opcijom ‚Äûreplay‚Äú.
6.	Ima dashboard koji uvek prikazuje:
o	pump signale, spoof signale, news flagove,
o	sve pozicije, rizik, PnL, globalni re≈æim,
o	health sistema i mod rada (SIM/DRY/LIVE).
7.	Radi deterministiƒçno:
o	jasan redosled koraka po tick-u,
o	backpressure & failover,
o	risk rollback ako ne≈°to pukne.
________________________________________
1. GLOBALNA ARHITEKTURA ‚Äì SCALPER-BASE
Koristimo postojeƒáu strukturu:
scalper-base/
  src/         ‚Üê AI engine, servisi
  web/         ‚Üê dashboard + auth + API
  data/        ‚Üê JSON arhiva, logovi
1.1 Servisi (logiƒçki procesi)
Kasnije ih mo≈æemo podeliti u vi≈°e procesa, ali logiƒçki imamo:
1.	Market Data Service
o	Bybit public WS + REST
o	odr≈æava orderbook + trades + micro-candles
2.	Strategy & Risk Service
o	feature engine (imbalance, walls, pump, flow, vola, news stub)
o	regime engine (symbol + global)
o	scoring engine (FinalScalpScore)
o	state ma≈°ina (po simbolu)
o	risk & portfolio
3.	Execution Service
o	Bybit private WS + REST
o	otvaranje/menjanje/ga≈°enje naloga
o	sync stvarnih pozicija
4.	Storage & Replay Service
o	JSON zapis
o	retention
o	replay (kasnije)
5.	Dashboard Backend
o	/web/server.js + /web/routes/api.js
o	ƒçita informacije iz Strategy & Risk + Storage
o	slu≈æi podatke UI-ju
Sve mo≈æe poƒçeti kao jedan Node proces, sa jasnim modulima, pa kasnije razbijamo na vi≈°e.
________________________________________
2. CONFIG & PATHS ‚Äì JEDNO MESTO (Windows + Linux)
2.1 src/config/paths.js
‚Ä¢	koristi import.meta.url + path.dirname da odredi root projekta.
‚Ä¢	export:
o	PROJECT_ROOT
o	DATA_DIR
o	LOG_DIR
o	PROFILES_DIR
o	SYSTEM_DIR
Svi moduli (storage, retention, web/auth, itd.) koriste OVO, nema vi≈°e hardkodovanih path-ova ‚Üí radi i na Windows i na Ubuntu.
2.2 src/config/index.js
‚Ä¢	globalni parametri:
o	MODE ‚àà {SIM, DRY_RUN, LIVE}
o	riskPerTrade, maxPortfolioHeat, dailyLossLimit
o	watchThreshold, armThreshold
o	latencyPriceBufferPct
o	fee parametri (maker/taker)
‚Ä¢	po kategoriji:
o	Prime/Normal/Wild ‚Üí specifiƒçni limiti (maxLeverage, maxSize...)
‚Ä¢	per-symbol override (kasnije upis u data/profiles/).
Hot reload (config ƒçita poslednju verziju bez restartovanja engine-a).
________________________________________
3. DETERMINISTIƒåKI PIPELINE & BACKPRESSURE
Ovo je kljuƒçni ‚Äûvrhunski‚Äú deo.
3.1 Event Loop Redosled
Za svaki ‚Äûtick‚Äú (po simbolu ili batch):
1.	Market Data Update
o	primi WS event (orderbook/trade/ticker)
o	a≈æurira lokalni snapshot / buffer
2.	Microstructure Update
o	iz snapshot-a i trades:
o	generi≈°e micro-candles (1s/3s/5s/15s)
o	a≈æurira delta, volume spike, vola
3.	Feature Engine
o	orderbook imbalance
o	walls & spoof
o	pump & anomaly
o	flow & delta
o	vola engine
o	fee & leverage
o	news stub
4.	Regime Engine
o	per-symbol RegimeState
o	global regime
5.	Scoring Engine
o	FinalScalpScoreLong/Short
o	penalizing pump, spoof, news, etc.
6.	State Machine
o	prelazi: FLAT ‚Üí WATCHING ‚Üí ARMED ‚Üí ORDER_PLACED ‚Üí IN_POSITION ‚Üí MANAGING ‚Üí EXITED ‚Üí COOLDOWN / BLOCKED_REGIME
o	odluka: treba li novi signal
7.	Risk & Portfolio Check
o	portfolio_heat
o	unrealized drawdown
o	daily loss
8.	Execution
o	ako je odobreno ‚Üí priprema nalog
o	uzima u obzir MODE (SIM/DRY/LIVE)
o	≈°alje izvr≈°enje ili simulaciju
9.	Logging & Events
o	upis u JSON (signal, state change, trade, pump event‚Ä¶)
o	event bus (za dashboard/alert)
10.	Dashboard Metrics
‚Ä¢	a≈æurira in-memory metrike koje ƒçita /api.
Sve to stoji u jednom centralnom modulu npr. src/core/engine.js koji orkestrira redosled.
3.2 Backpressure & Safety
Ako:
‚Ä¢	latency izmeƒëu ‚Äûtick‚Äú poƒçetka i kraja > X ms (npr. 300ms)
‚Üí engine prelazi u:
‚Ä¢	DEGRADED_MODE:
o	ne otvara nove trejdove,
o	samo odr≈æava postojeƒáe i risk kontrolu,
o	loguje event.
Ako backlog WS eventova raste (npr. queue > N):
‚Ä¢	odbaci najstarije ‚Äûhigh frequency‚Äú evente za memecoin-e,
‚Ä¢	uvek ƒçuvaj full fidelity za BTC/ETH/Prime.
________________________________________
4. BYBIT KONEKTORI (PUBLIC + PRIVATE) + FAILOVER
4.1 src/connectors/bybitPublic.js
‚Ä¢	REST:
o	instruments ‚Äì filtira linear USDT perpe
o	initial orderbook snapshot
‚Ä¢	WS:
o	subs na: orderbook, trades, tickers
‚Ä¢	health:
o	ping/pong, reconnect logika
o	status: CONNECTED / RECONNECTING / DOWN
Failover:
‚Ä¢	exponential backoff na reconnect
‚Ä¢	ako padne preko odreƒëenog vremena:
o	globalRegime ‚Üí RISK_OFF
o	ne otvaraj nove pozicije
4.2 src/connectors/bybitPrivate.js
‚Ä¢	REST:
o	balance/equity
o	open positions / orders
o	place/modify/cancel order
‚Ä¢	WS:
o	order i position update feed
Rate-limit & retry:
‚Ä¢	ograniƒçi QPS
‚Ä¢	retry sa backoff-om na 429/5xx
________________________________________
5. UNIVERSE + SYMBOL PERFORMANCE TRACKER
5.1 src/market/universe.js
‚Ä¢	uƒçitava listu simbola (USDT perp)
‚Ä¢	setuje category: Prime / Normal / Wild
‚Ä¢	detektuje nove simbole (svakih 15s):
o	doda WILD + NEWS-LISTING flag
‚Ä¢	izbacuje delistovane ili LONG-term neaktivne.
5.2 src/market/symbolProfile.js
‚Ä¢	ƒçuva i a≈æurira:
o	winrate po simbolu
o	proseƒçan MFE/MAE
o	proseƒçan slippage
o	frequency pump re≈æima
o	spoofing pattern-e
Na osnovu toga:
‚Ä¢	automatski reduce size,
‚Ä¢	podi≈æe required FinalScalpScore,
‚Ä¢	eventualni auto-blacklist.
ƒåuva se u data/profiles/<symbol>.json.
________________________________________
6. STORAGE & RETENTION (JSON)
6.1 src/storage/jsonStore.js
‚Ä¢	standardizovan API:
o	append(type, symbol, obj)
o	setSnapshot(type, symbol, obj)
‚Ä¢	type npr. ‚Äûorderbook‚Äú, ‚Äûtrades_stream‚Äú, ‚Äûevents‚Äú, ‚Äûmetrics‚Äú, ‚Äûtrades_log‚Äú, itd.
‚Ä¢	pi≈°e u:
data/
  orderbook/
  trades_stream/
  microcandles/
  metrics/
  events/
  trades_log/
  profiles/
  system/
6.2 src/storage/retention.js
‚Ä¢	periodiƒçno (npr. svaka 2h) pregleda:
o	bri≈°e raw evente >24h
o	ostavlja:
ÔÇß	per-day summary u trades_log/day-YYYY-MM-DD.json
ÔÇß	per-symbol profile
Loguje retention event u data/system/retention.log.jsonl.
________________________________________
7. REAL-TIME DATA PIPELINES
7.1 Orderbook
‚Ä¢	per symbol snapshot:
o	Prime: top 50‚Äì100 nivoa
o	Normal: top 50
o	Wild: top 20
7.2 Trades (tape)
‚Ä¢	ring buffer poslednjih 1000‚Äì2000 trejdova:
o	time, price, qty, side (agresivni kupac/prodavac)
7.3 Micro-candles
‚Ä¢	1s, 3s, 5s, 15s:
o	OHLC, volume, delta (buy/sell)
‚Ä¢	pi≈°e u data/microcandles.
________________________________________
8. FEATURE ENGINE
U src/features/:
1.	orderbookImbalance.js
o	level1 TOB
o	zonal depth imbalance
2.	wallsSpoof.js
o	zidovi (size >> avg)
o	ABSORBING vs SPOOFING
o	outputs:
ÔÇß	WallSupportScore, WallResistanceScore
ÔÇß	SpoofingScore
3.	pumpEngine.js
o	stanja: NONE, PREPUMP, PUMPING, BLOWOFF, DUMP, COOLDOWN
o	koristi price% change, volume spike, trade-per-second, orderbook thinning
4.	flowDelta.js
o	AggBuy vs AggSell
o	DeltaVol, streak
5.	volatility.js
o	micro ATR (1s/3s)
o	VolatilityScore, ExplosionFlag
6.	feeLeverage.js
o	izraƒáunava MinMoveForProfit
o	LiqSafetyScore (distance entry‚Äìliq)
7.	newsFlagsStub.js
o	stub za sada (ruƒçni flagovi)
o	output:
ÔÇß	NewsImpactScore, NewsType, NewsTime
Sve feature-e bele≈æimo per symbol u data/metrics/<symbol>.json (rolling).
________________________________________
9. REGIME ENGINE
9.1 symbolRegime.js
‚Ä¢	input:
o	PumpState
o	SpoofingScore
o	NewsImpactScore
o	VolatilityScore
‚Ä¢	output:
o	RegimeState(symbol) ‚àà {NORMAL, PUMP, MANIPULATED, NEWS_DRIVEN, COOLDOWN}
9.2 globalRegime.js
‚Ä¢	posmatra BTC/ETH vola, korelacije i ≈°okove
‚Ä¢	stanja:
o	GLOBAL_NORMAL
o	GLOBAL_RISK_OFF
o	GLOBAL_PANIC
Ako GLOBAL_PANIC ‚Üí Ne otvara nove pozicije, samo ≈°titi postojeƒáe.
________________________________________
10. SCORING & SIGNAL ENGINE
src/scoring/scalpScore.js:
‚Ä¢	bazni score:
o	orderbook, flow, vola, fee, leverage
‚Ä¢	korekcije:
o	PumpState PUMPING/BLOWOFF ‚Üí penal za long
o	visok SpoofingScore ‚Üí penal / blok
o	NewsImpactScore visok ‚Üí poseban mod
o	RegimeState = MANIPULATED ‚Üí disable
Rezultat:
‚Ä¢	FinalScalpScoreLong
‚Ä¢	FinalScalpScoreShort
Thresholds:
‚Ä¢	watch_threshold
‚Ä¢	arm_threshold
Samo kad:
‚Ä¢	RegimeState ‚àà {NORMAL, COOLDOWN_DONE}
‚Ä¢	FinalScore > odgovarajuƒái threshold
‚Üí signal ide u state ma≈°inu.
________________________________________
11. STATE MA≈†INA
src/state/stateMachine.js:
Stanja:
1.	FLAT
2.	WATCHING_LONG / WATCHING_SHORT
3.	ARMED_LONG / ARMED_SHORT
4.	ORDER_PLACED
5.	IN_POSITION
6.	MANAGING
7.	EXITED
8.	COOLDOWN
9.	BLOCKED_REGIME
Prelazi:
‚Ä¢	FLAT ‚Üí WATCHING ako FinalScore > watch threshold + Regime OK
‚Ä¢	WATCHING ‚Üí ARMED ako dodatni uslovi (walls, flow, no fresh bad news)
‚Ä¢	bilo koji ‚Üí BLOCKED_REGIME ako Regime postane PUMP/MANIPULATED/NEWS_HIGH_RISK
‚Ä¢	IN_POSITION ‚Üí MANAGING ‚Üí EXITED / COOLDOWN na osnovu TP/SL/hard stop
Sve state change se loguju u data/events/<symbol>.json.
________________________________________
12. RISK & PORTFOLIO ENGINE
src/risk/riskEngine.js + src/state/portfolio.js:
‚Ä¢	per trade:
o	risk per trade (R)
o	izraƒçun size iz SL distance + leverage + fee + latency buffer
‚Ä¢	portfolio:
o	portfolio_heat = sum(risk_per_position)
o	unrealized_drawdown
o	daily realized PnL
Ako:
‚Ä¢	portfolio_heat > maxHeat
ili
‚Ä¢	unrealized_drawdown > unrealizedLimit
ili
‚Ä¢	dailyLoss > dailyLossLimit
‚Üí RISK_OFF:
‚Ä¢	ne otvaraj nove trejdove
‚Ä¢	po potrebi zatvori najriziƒçnije.
________________________________________
13. TP/SL, BREAK-EVEN & FEE-FIRST
src/execution/tpslPlanner.js:
1.	Fee-first:
o	TP1 nikad ispod MinMoveForProfit.
2.	Break-even trigger:
o	kada unrealizedPnL >= FeeTotal * (1 + bufferK):
ÔÇß	SL ‚Üí entry ¬± fee+buffer
3.	Pump aware:
o	PumpState BLOWOFF ‚Üí agresivnije uzimanje profita, zatezanje trailing-a
o	MANIPULATED/NEWS_HIGH_RISK ‚Üí ≈°iri SL ili ne trejdovati.
________________________________________
14. EXECUTION ENGINE + RISK ROLLBACK
src/execution/executionEngine.js:
‚Ä¢	Maker-preferred entry, fallback na taker
‚Ä¢	auto-cancel:
o	book/flow/news promene sliku pre fill-a
‚Ä¢	pre izvr≈°enja:
o	proveri RegimeState
o	proveri portfolio heat
o	proveri mode (SIM/DRY/LIVE)
Trade Integrity / Rollback:
‚Ä¢	periodiƒçni sync sa Bybit:
o	lokalne pozicije == Bybit pozicije?
‚Ä¢	ako ne:
o	INTEGRITY_BROKEN event
o	blokira nove trejdove
o	opcija PANIC CLOSE ALL
o	loguje detalje
Kill switch:
‚Ä¢	mre≈æa/API problemi
‚Ä¢	ekstremni spread / vola
‚Ä¢	ruƒçni ‚ÄûPANIC‚Äú sa dashboarda.
________________________________________
15. MODOVI RADA: SIM / DRY-RUN / LIVE
src/execution/modeManager.js:
‚Ä¢	MODE globalno vidljiv (API + dashboard)
‚Ä¢	prelazak u LIVE zahteva:
o	dvostruku potvrdu + mo≈æda ‚ÄûPIN‚Äú ili lozinku
‚Ä¢	SIM:
o	sve odluke kao LIVE
o	ali sve se izvr≈°ava lokalno (simulated fills)
‚Ä¢	DRY-RUN:
o	real-time feed, realni market data
o	ali i dalje bez realnih naloga
________________________________________
16. LOGGING & REPLAY
src/monitoring/logger.js:
‚Ä¢	JSONL format:
o	signal event
o	state change
o	trade event
o	pump/spoof/news event
o	error
src/storage/replay.js:
‚Ä¢	ƒçita logove iz perioda i re-pu≈°uje evente u engine kao da su live
‚Ä¢	omoguƒáava backtest bez rizika.
________________________________________
17. MONITORING, METRICS & DASHBOARD API
src/monitoring/metrics.js:
‚Ä¢	global metrics:
o	equity, balance
o	realized/unrealized PnL
o	portfolio heat
o	globalRegime
o	MODE
o	broj pozicija
o	Bybit WS/REST health
o	error rate
Sve to izla≈æemo preko web/routes/api.js:
‚Ä¢	GET /api/health
‚Ä¢	GET /api/summary
‚Ä¢	GET /api/hotlist
‚Ä¢	GET /api/symbol/:symbol
‚Ä¢	GET /api/trades/active
‚Ä¢	GET /api/events/recent
Plus kasnije:
‚Ä¢	POST /api/panic-close
‚Ä¢	POST /api/pause
‚Ä¢	POST /api/blacklist-symbol
‚Ä¢	POST /api/mode (SIM/DRY/LIVE)
Dashboard kartice:
‚Ä¢	Global panel (summary + mode + globalRegime + heat)
‚Ä¢	Hot list (po simbolu: category, RegimeState, PumpState, Spoofing, News, scores, state)
‚Ä¢	Active trades
‚Ä¢	Event feed (pump üî•, news üö®, spoof üé≠)
‚Ä¢	Symbol detail (orderbook + micro-candles + delta + events)
________________________________________
18. REDOSLED IMPLEMENTACIJE (VRHUNSKI, ALI TESTIRLJIV)
1.	Config & Paths (paths.js, index.js) + health skeleton.
2.	Bybit Public connector + Universe
o	minimalni /api/summary i /api/health na dashboardu.
3.	JSON storage + retention
o	/api/storage/status.
4.	Orderbook + Trades + Micro-candles pipeline
o	osnovni metrics na dashboardu (price, spread, vola).
5.	Feature engine (imbalance, walls, spoof, flow, vola, fee)
o	prikaz osnovnih score-ova na ‚ÄûSymbol detail‚Äú.
6.	Pump engine + Regime (symbol + global)
o	PumpState, RegimeState, ikone na ‚ÄûHot list‚Äú.
7.	Scoring & State ma≈°ina
o	log signal/state change + prikaz u UI.
8.	Risk & Portfolio engine
o	portfolio heat + risk status na dashboardu.
9.	TP/SL planner + break-even
o	integracija sa state ma≈°inom (MANAGING).
10.	Execution engine (SIM mode)
o	full signal ‚Üí ‚Äûsim‚Äú trade sa JSON logom + UI prikaz.
11.	Integrity check + risk rollback + kill switch.
12.	DRY-RUN & LIVE mod + guard rails.
13.	Logging + Replay modul.

