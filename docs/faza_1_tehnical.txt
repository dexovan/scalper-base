FAZA 1 â€“ FULL TECHNICAL REPORT

(moÅ¾eÅ¡ odmah da kopiraÅ¡ u faza-1-report.md)

FAZA 1 â€“ Setup Dashboard Servera, Autentifikacije i PM2 infrastrukture
AI Scalper Project â€“ Technical Phase Report
#ï¸âƒ£ 1. Cilj Faze 1

Faza 1 imala je jasan zadatak:

Postaviti potpuno stabilan i bezbedan web server za dashboard koji Ä‡e kasnije prikazivati AI scalping engine metrike.

Potrebno je bilo obezbediti:

Stabilan Node.js server (Express)

Login sistem (korisnici + bcrypt + SQLite)

Sesije sa sigurnim Äuvanjem (SQLite Store)

Pravilne putanje (apsolutni pathovi â€“ PM2 kompatibilni)

PM2 proces manager â€“ stabilan na naÅ¡em VPS-u u Singapuru

Eliminacija svih modula koji se ruÅ¡e kada se server startuje preko PM2

Debug sistem (PATH TEST, SESSION DEBUG, HEALTH CHECK)

ğŸŸ¦ 2. Å ta je uraÄ‘eno u Fazi 1 (kompletna lista)
âœ” 2.1 Postavljen je Express server

â€“ ejs template engine
â€“ express-ejs-layouts
â€“ public folder
â€“ views folder
â€“ layout sistem
â€“ static serving

âœ” 2.2 Napravljen je kompletan login sistem

Moduli:

/web/auth/auth.js â€“ SQLite user DB, bcrypt hashing

/web/routes/auth.js â€“ rute za login/logout

default admin user automatski generisan:
admin / admin123

âœ” 2.3 SQLite baza korisnika generisana automatski

Fajl:

/data/users.db


Tabela:

users (id, username, password, createdAt)

âœ” 2.4 Napravljen session sistem â€“ SQLite store

Direktorijum:

/data/sessions/sessions.db


KoriÅ¡Ä‡en modul:

connect-sqlite3


Sesije se Äuvaju 30 minuta i rade i pod PM2 procesima.

âœ” 2.5 Napravljen globalni fix za PM2 + express-session

PM2 je pokuÅ¡avao da uÄita:

express-session/session/store
express-session/session/memory
./session


ali je PM2 preload sistem kvario putanje i generisao:

âŒ MODULE_NOT_FOUND

ReÅ¡enje:

âœ” Override Node.js loader-a:

import Module from "module";

const originalLoad = Module._load;

Module._load = function(request, parent, isMain) {
  if (request.includes("express-session/session/store")) {
    return originalLoad.apply(this, ["/home/aiuser/scalper-base/node_modules/express-session/session/store.js", parent, isMain]);
  }
  return originalLoad.apply(this, arguments);
};


Ovo sprjeÄava PM2 da traÅ¾i pogreÅ¡ne module.

âœ” 2.6 Napravljen PATH sistem (apsolutne putanje)

paths.js sada generiÅ¡e apsolutne putanje poput:

PROJECT_ROOT

DATA_DIR

TMP_DIR

SYSTEM_DIR

ORDERBOOK_DIR

SESSIONS_DIR

Ovo je kljuÄan fix, jer PM2 NE koristi process.cwd() kao Å¡to koristi node index.js.

âœ” 2.7 Napravljen HEALTH monitor

/src/monitoring/health.js pokreÄ‡e:

heartbeat log

interval health check

fail detection

âœ” 2.8 Implementiran SESSION DEBUG middleware

Na svaki request vidimo:

session ID

user objekt (prijavljen ili ne)

cookie info

PomaÅ¾e u identifikaciji login problema.

âœ” 2.9 Total rebuild PM2 na serveru

Server je imao:

PM2 6.x (root)
PM2 6.x (aiuser)
PM2 5.x


To je pravilo haos.

Mi smo uradili:

sudo pkill -f PM2
sudo rm -rf /root/.pm2
sudo rm -rf /home/aiuser/.pm2
sudo rm -rf /usr/lib/node_modules/pm2
sudo chown -R aiuser:aiuser /usr/lib/node_modules
sudo chown -R aiuser:aiuser /usr/bin
npm install -g pm2


Na kraju ostao je samo:

âœ” PM2 6.0.13 â€” potpuno Äist i stabilan

âœ” 2.10 PM2 sada radi ispravno

Test komanda:

pm2 start web/server.js --name dashboard
pm2 save

ğŸŸ¥ 3. Problemi koji su se pojavili i kako smo ih reÅ¡ili
âŒ Problem 1 â€” MODULE_NOT_FOUND: express-session/session/store.js
ğŸ” Uzrok:

PM2 injectuje svoj loader u require i remeti path za ESM module.

âœ” ReÅ¡enje:

Napravili smo Node.js hook:

Module._load override


â†’ sada PM2 uvek uÄitava PRAVU verziju fajla.

âŒ Problem 2 â€” SQLITE_CANTOPEN

ÄŒesto se javlja ispod PM2 sa greÅ¡kom:

Error: SQLITE_CANTOPEN: unable to open database file

Uzrok:

PM2 startuje aplikaciju iz razliÄitog cwd, pa SQLite pokuÅ¡ava da otvori DB u pogreÅ¡nom direktorijumu.

ReÅ¡enje:

âœ” Apsolutni pathovi u paths.js
âœ” Kreiranje foldera pre kreiranja DB
âœ” Test read/write za sessions folder
âœ” Silent ignore za CANTOPEN noise (ali ne za realne greÅ¡ke)

âŒ Problem 3 â€” PM2 phantom proces zauzima port 8080
Uzrok:

Nekada PM2 ostavi zombija iza sebe.

ReÅ¡enje:
sudo lsof -i :8080
kill -9 PID

âŒ Problem 4 â€” Duplirani PM2 instalirani (root + aiuser)
Uzrok:

Rani globalni PM2 instalacije.

ReÅ¡enje:

Potpuno ÄiÅ¡Ä‡enje root i user PM2 instanci i reinstall.

âŒ Problem 5 â€” users.db nije postojao pa login nije radio
ReÅ¡enje:

U auth.js dodato:

CREATE TABLE IF NOT EXISTS users


i:

if no users -> create default admin

ğŸŸ© 4. Kako reÅ¡avati ovakve probleme u buduÄ‡nosti
ğŸ”§ 4.1 Ako se pojavi SQLITE_CANTOPEN

Proveri da li folder postoji

Proveri permissions:

ls -la /path
chown -R aiuser:aiuser /path
chmod -R 755 /path


Proveri da nije PM2 pogreÅ¡no uÄitao cwd:
â€“ koristi apsolutne putanje

ğŸ”§ 4.2 Ako PM2 ne moÅ¾e da uÄita module

Uvek uraditi:

pm2 logs --lines 100


Ako piÅ¡e MODULE_NOT_FOUND, reÅ¡enje je:

dodati override u Module._load

ili proveriti da li postoji dupli PM2

ğŸ”§ 4.3 Ako port 8080 ne radi
sudo lsof -i :8080
kill -9 PID
pm2 restart dashboard

ğŸ”§ 4.4 Ako login prestane da radi

obriÅ¡i users.db

rm data/users.db
pm2 restart dashboard


default admin Ä‡e se ponovo kreirati.

ğŸ’  5. ZakljuÄak

U Fazi 1:

oÄistili smo VPS od duplih PM2

stabilizovali loader i module

stabilizovali sessions

napravili korisniÄku bazu

omoguÄ‡ili login

omoguÄ‡ili da PM2 radi identiÄno kao node server.js

dashboard je sada potpuno stabilan i spreman za Fazu 2
